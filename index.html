<!DOCTYPE html>
<html>
    <head>
        <title>Access Paperspace machine</title>
        <meta charset="UTF-8">
        <style>
            body {>
                background-color: white;
            }
            #main {
                color: black;
                font-family: Arial, Helvetica, sans-serif;
                font-weight: bold;
                font-size: 3em;
                text-align: center;
                padding: 200px 0;
            }
        </style>
        
        <body>
            <button onclick="sendPaperspace('/start')">Start Machine</button>
            <button onclick="sendPaperspace('/stop')">Shutdown Machine</button>
            <button onclick="sendPaperspace('/restart')">Restart Machine</button>
            <button onclick="getStatusPaperspace()">Get Machine Status</button>
            
            <p>Machine status: <span id = "statusText">getting status...</span></p>
        </body>

        <script type="text/javascript">
            "use strict";     
            
            const sleep = (milliseconds) => { return new Promise(resolve => setTimeout(resolve, milliseconds)) }
            
            var machineId = '<insert here>';
            var apiKey = '<insert here>';
            
            // Display current status when page loads
            statusText.onload = getStatusPaperspace();
            
            // Get the status every few seconds, continuously
            setInterval(getStatusPaperspace, 1000);
            
            // Start, restart, or shutdown the machine
            function sendPaperspace(action)
            {   
                var url = 'https://api.paperspace.io/machines/' + machineId + action;
                var xhr = new XMLHttpRequest();
                xhr.open("POST", url, true);
                xhr.setRequestHeader("x-api-key", apiKey);
                xhr.send();
            }  
            
            // Get the status of the machine
            function getStatusPaperspace()
            {   
                var url = 'https://api.paperspace.io/machines/getMachinePublic?machineId=' + machineId;
                var xhr = new XMLHttpRequest();
                xhr.open("GET", url, true);
                xhr.setRequestHeader("x-api-key", apiKey);
                xhr.responseType = 'json';
                xhr.send();
                
                xhr.onload = function() 
                {
                    var state = xhr.response.state;
                    document.getElementById("statusText").innerHTML = state;
                };
            }   
        </script>
    </head>
</html>
